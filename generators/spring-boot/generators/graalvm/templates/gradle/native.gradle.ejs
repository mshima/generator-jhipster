graalvmNative {
  toolchainDetection = true
  binaries {
    main {
      imageName = 'native-executable'
      //this is only needed when you toolchain can't be detected
      //javaLauncher = javaToolchains.launcherFor {
      //  languageVersion = JavaLanguageVersion.of(19)
      //  vendor = JvmVendorSpec.matching("GraalVM Community")
      //}
    }
    binaries.all {
      verbose = true
      jvmArgs.add('-Xms4g')
      jvmArgs.add('-Xmx10g')
    }
  }
}

processTestAot {
  jvmArgs += ["-XX:+AllowRedefinitionToAddDeleteMethods"]
}

processResources {
  filesMatching("**/application-dev.yml") {
    filter {
      it.replace("@spring.h2.console.enabled@", String.valueOf(!project.hasProperty("native")))
    }
  }
}

if (project.hasProperty("native")) {
<%_ if (!reactive && databaseTypeSql) { _%>
  hibernate {
    enhancement {
      enableLazyInitialization = true
    }
  }
<%_ } _%>
}
<%_ if (reactive) { _%>

configurations.all {
  exclude group:"commons-logging", module: "commons-logging"
}
<%_ } _%>
